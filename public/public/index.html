<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>crumbs.host/testnet – Pi Network Testnet Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; background:#0b1020; color:#e5e7eb; margin:0; }
    header { padding:20px; background:#020617; border-bottom:1px solid #1e293b; }
    h1 { margin:0 0 6px 0; font-size:24px; }
    .sub { font-size:13px; color:#9ca3af; }
    .container { padding:20px; max-width:1300px; margin:auto; }
    .controls { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px; }
    input, select, button {
      background:#020617; color:#e5e7eb; border:1px solid #1e293b;
      padding:6px 10px; border-radius:6px;
    }
    button:hover { background:#020617; opacity:.9; cursor:pointer; }
    table { width:100%; border-collapse:collapse; margin-top:8px; }
    th, td { border:1px solid #1e293b; padding:6px 8px; font-size:13px; }
    th { background:#020617; cursor:pointer; position:sticky; top:0; }
    tr:nth-child(even){ background:#020617; }
    .badge { padding:2px 6px; border-radius:4px; font-size:11px; }
    .nft { background:#7c2d12; }
    .token { background:#064e3b; }
    .footer { padding:12px; text-align:center; font-size:12px; color:#9ca3af; }
    .pager { margin-top:10px; display:flex; gap:6px; align-items:center; }
  </style>
</head>
<body>

<header>
  <h1>Pi Network Testnet – Token & Asset Explorer</h1>
  <div class="sub">Unofficial • Read-only • Data from Horizon API • Testnet ≠ Mainnet</div>
</header>

<div class="container">
  <div class="controls">
    <input type="text" id="search" placeholder="Search asset / issuer…" />
    <select id="filter">
      <option value="all">All</option>
      <option value="token">Non-NFT</option>
      <option value="nft">NFT-like</option>
    </select>
    <button onclick="sortByBalances()">Sort by Balances</button>
    <a href="../data/tokens.csv" download>
      <button>Download CSV</button>
    </a>
    <span id="stats"></span>
    <span id="refresh"></span>
  </div>

  <table>
    <thead>
      <tr>
        <th>Asset Code</th>
        <th>Issuer</th>
        <th>Authorized Balances</th>
        <th>Type</th>
        <th>Last Ledger</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="pager">
    <button onclick="prevPage()">◀ Prev</button>
    <span id="pageinfo"></span>
    <button onclick="nextPage()">Next ▶</button>
  </div>

  <div id="updated"></div>
</div>

<div class="footer">
  crumbs.host/testnet is an independent Pi Testnet explorer. Not affiliated with Pi Core Team.
</div>

<script>
let assets = [];
let sortDesc = true;
let page = 1;
const PAGE_SIZE = 25;

fetch("../data/tokens.json")
  .then(r => r.json())
  .then(data => {
    assets = data;
    render();
    setInterval(() => {
      document.getElementById("refresh").innerText = "Auto-refresh enabled";
    }, 1000);
  });

function filtered() {
  const q = document.getElementById("search").value.toLowerCase();
  const f = document.getElementById("filter").value;
  return assets.filter(a => {
    const match =
      a.asset_code?.toLowerCase().includes(q) ||
      a.issuer?.toLowerCase().includes(q);
    const type =
      f === "all" ||
      (f === "token" && !a.is_nft_like) ||
      (f === "nft" && a.is_nft_like);
    return match && type;
  });
}

function render() {
  const data = filtered();
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  const start = (page-1)*PAGE_SIZE;
  const rows = data.slice(start, start+PAGE_SIZE);

  for (const a of rows) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${a.asset_code}</td>
      <td style="font-family:monospace">${a.issuer}</td>
      <td>${a.authorized_balances}</td>
      <td><span class="badge ${a.is_nft_like ? "nft" : "token"}">
        ${a.is_nft_like ? "NFT-like" : "Token"}
      </span></td>
      <td>${a.last_modified_ledger}</td>
    `;
    tbody.appendChild(tr);
  }

  const tokens = assets.filter(a => !a.is_nft_like).length;
  const nfts = assets.filter(a => a.is_nft_like).length;

  document.getElementById("stats").innerText =
    `Total: ${assets.length} | Tokens: ${tokens} | NFT-like: ${nfts}`;

  document.getElementById("pageinfo").innerText =
    `Page ${page} / ${Math.ceil(data.length / PAGE_SIZE)}`;

  document.getElementById("updated").innerText =
    "Last updated: " + (assets[0]?.last_updated || "N/A");
}

function sortByBalances() {
  assets.sort((a,b) =>
    sortDesc
      ? b.authorized_balances - a.authorized_balances
      : a.authorized_balances - b.authorized_balances
  );
  sortDesc = !sortDesc;
  page = 1;
  render();
}

function nextPage() {
  page++;
  render();
}
function prevPage() {
  if (page > 1) page--;
  render();
}

document.getElementById("search").oninput = () => { page=1; render(); };
document.getElementById("filter").onchange = () => { page=1; render(); };
</script>

</body>
</html>
