<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>crumbs.host – Pi Wallet Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; background:#0b1020; color:#e5e7eb; margin:0; }
    header { padding:20px; background:#020617; border-bottom:1px solid #1e293b; }
    h1 { margin:0 0 6px 0; font-size:24px; }
    .sub { font-size:13px; color:#9ca3af; }
    .badge-net { padding:4px 10px; border-radius:999px; font-size:12px; font-weight:bold; }
    .testnet { background:#1e40af; }
    .mainnet { background:#065f46; }

    .container { padding:20px; max-width:1200px; margin:auto; }
    .box { background:#020617; border:1px solid #1e293b; border-radius:10px; padding:12px; margin-bottom:14px; }
    .mono { font-family:monospace; font-size:13px; }
    table { width:100%; border-collapse:collapse; margin-top:8px; }
    th, td { border:1px solid #1e293b; padding:6px 8px; font-size:13px; }
    th { background:#020617; position:sticky; top:0; }
    tr:nth-child(even){ background:#020617; }
    .footer { padding:12px; text-align:center; font-size:12px; color:#9ca3af; }
    input, button {
      background:#020617; color:#e5e7eb; border:1px solid #1e293b;
      padding:6px 10px; border-radius:6px;
    }
    button:hover { opacity:.9; cursor:pointer; }
    a { color:#93c5fd; text-decoration:none; }
  </style>
</head>
<body>

<header>
  <h1>
    Pi Wallet Tracker
    <span id="netBadge" class="badge-net"></span>
  </h1>
  <div class="sub" id="subtitle"></div>
</header>

<div class="container">

  <div class="box">
    <input id="addrInput" class="mono" style="width:70%" placeholder="Paste Pi / Stellar Address (G...)" />
    <button onclick="go()">Track</button>
  </div>

  <div class="box" id="walletBox"></div>
  <div class="box" id="txBox"></div>

</div>

<div class="footer">
  crumbs.host is an independent Pi Network explorer. Not affiliated with Pi Core Team.
</div>

<script>
// ==== NETWORK SWITCH ====
const params = new URLSearchParams(window.location.search);
const network = params.get("net") || "testnet"; // testnet | mainnet
const address = params.get("addr") || "";

document.getElementById("netBadge").innerText = network.toUpperCase();
document.getElementById("netBadge").classList.add(network);
document.getElementById("subtitle").innerText =
  network === "mainnet"
    ? "Read-only • Data from Pi Mainnet Horizon API"
    : "Read-only • Data from Pi Testnet Horizon API";

// ==== API ENDPOINT ====
const API = network === "mainnet"
  ? "https://api.mainnet.minepi.com"
  : "https://api.testnet.minepi.com";

if (address) {
  document.getElementById("addrInput").value = address;
  loadWallet(address);
}

function go() {
  const a = document.getElementById("addrInput").value.trim();
  if (!a.startsWith("G") || a.length !== 56) {
    alert("Alamat tidak valid. Harus diawali G dan 56 karakter.");
    return;
  }
  const url = `?net=${network}&addr=${a}`;
  window.location = url;
}

function loadWallet(addr) {
  fetch(`${API}/accounts/${addr}`)
    .then(r => r.json())
    .then(acc => {
      document.getElementById("walletBox").innerHTML = `
        <b>Wallet</b><br/>
        <span class="mono">${addr}</span><br/><br/>
        Sequence: ${acc.sequence}<br/>
        Subentries: ${acc.subentry_count}<br/>
        Balances:<br/>
        <ul>
          ${acc.balances.map(b => `<li>${b.balance} ${b.asset_code || "PI"}</li>`).join("")}
        </ul>
      `;
    })
    .catch(() => {
      document.getElementById("walletBox").innerText = "Wallet not found / API error.";
    });

  fetch(`${API}/accounts/${addr}/transactions?order=desc&limit=10`)
    .then(r => r.json())
    .then(tx => {
      const rows = tx._embedded.records.map(t => `
        <tr>
          <td class="mono">${t.hash}</td>
          <td>${t.ledger}</td>
          <td>${new Date(t.created_at).toLocaleString()}</td>
        </tr>
      `).join("");

      document.getElementById("txBox").innerHTML = `
        <b>Latest Transactions</b>
        <table>
          <thead>
            <tr>
              <th>Hash</th>
              <th>Ledger</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    });
}
</script>

</body>
</html>
