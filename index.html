<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CRUMBS.HOST ‚Äì CORE+++++++ | Pi Network Ultra Monitor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- ===== Navbar ===== -->
<nav>
  <a href="index.html">CORE++++</a>
  <a href="omega-console.html">Omega</a>
  <a href="cosmic-core.html">Cosmic</a>
  <a href="god-ai-core.html">God AI</a>
  <a href="quantum-sentinel.html">Sentinel</a>
  <a href="pools-radar.html">Pools</a>
</nav>

<header><h1>üöÄ CRUMBS.HOST ‚Äì CORE+++++++</h1></header>

<!-- ===== Status Panel ===== -->
<div class="panel fade" id="statusPanel">
  <h2>üåê Network Status</h2>
  <div id="status-box">Loading...</div>
  <div id="aiScore"></div>
</div>

<!-- ===== Ledger / dApps / DEX Chart ===== -->
<div class="panel fade">
  <h2>üìä Ledger / dApps / DEX Activity</h2>
  <canvas id="txChart" height="150"></canvas>
</div>

<!-- ===== Asset List ===== -->
<div class="panel fade">
  <h2>ü™ô Token / Asset List</h2>
  <table>
    <thead><tr><th>Asset</th><th>Issuer</th><th>Accounts</th></tr></thead>
    <tbody id="assetTable"></tbody>
  </table>
</div>

<!-- ===== dApps Radar ===== -->
<div class="panel fade">
  <h2>üì± Pi dApps Radar</h2>
  <input id="appSearch" placeholder="Cari dApp..." style="width:100%" onkeyup="filterApps()">
  <ul id="appList"></ul>
</div>

<!-- ===== DEX / Liquidity Monitor ===== -->
<div class="panel fade">
  <h2>üí± DEX / Liquidity Monitor</h2>
  <table>
    <thead><tr><th>Pair</th><th>Price</th><th>Volume</th></tr></thead>
    <tbody id="dexTable"></tbody>
  </table>
</div>

<footer style="text-align:center; padding:10px; opacity:0.7;">CORE+++++++ ‚Ä¢ Pi Network Testnet ‚Ä¢ crumbs.host</footer>

<script>
const PI_HORIZON="https://api.testnet.minepi.com";
let lastTxCount=0;

// Push Notification
if("Notification" in window) Notification.requestPermission();

// Neon Popup Alert
function showAlert(msg){
  const div=document.createElement("div");
  div.className="alert-popup";
  div.innerText=msg;
  document.body.appendChild(div);
  setTimeout(()=>div.remove(),3000);
}

// Network Status + AI Score + Alert
async function loadNetworkStatus(){
  try{
    const res=await fetch(`${PI_HORIZON}/ledgers?order=desc&limit=5`);
    const data=await res.json();
    const ledgers=data._embedded.records;
    const latest=ledgers[0];

    document.getElementById("status-box").innerHTML=`
      <p>Latest Ledger: ${latest.sequence}</p>
      <p>Closed At: ${latest.closed_at}</p>
      <p>Total TX: ${latest.successful_transaction_count}</p>
      <p>Status: <span style="color:#00ff6a">ONLINE</span></p>
    `;

    const avgTx=(ledgers.reduce((sum,l)=>sum+l.successful_transaction_count,0)/5).toFixed(2);
    document.getElementById("aiScore").innerHTML=`<p>ü§ñ AI Score (Predicted Activity): ${avgTx}</p>`;

    if(lastTxCount && latest.successful_transaction_count>lastTxCount*1.5){
      showAlert(`‚ö° TX Spike! Ledger ${latest.sequence}: ${latest.successful_transaction_count} TX`);
      if(Notification.permission==="granted"){
        new Notification("‚ö° TX Spike Detected!",{
          body:`Ledger ${latest.sequence} has ${latest.successful_transaction_count} transactions!`,
          icon:"https://minepi.com/favicon.png"
        });
      }
    }
    lastTxCount=latest.successful_transaction_count;
  }catch{ document.getElementById("status-box").innerHTML=`<p>Status: <span style="color:red">OFFLINE</span></p>`; }
}

// TX + dApps + DEX Chart
let txChart;
async function loadCharts(){
  const resLedger=await fetch(`${PI_HORIZON}/ledgers?order=desc&limit=10`);
  const dataLedger=await resLedger.json();
  const records=dataLedger._embedded.records.reverse();
  const labels=records.map(l=>l.sequence);
  const txValues=records.map(l=>l.successful_transaction_count);
  const dappsValues=records.map(()=>Math.floor(Math.random()*10)+1);
  const dexValues=records.map(()=>Math.floor(Math.random()*20)+10);

  if(!txChart){
    const ctx=document.getElementById("txChart").getContext("2d");
    txChart=new Chart(ctx,{
      type:"line",
      data:{
        labels,
        datasets:[
          {label:"TX per Ledger", data:txValues, borderColor:"#00ff6a", fill:false},
          {label:"dApps Activity", data:dappsValues, borderColor:"#ff00ff", fill:false},
          {label:"DEX Volume", data:dexValues, borderColor:"#00ffff", fill:false}
        ]
      },
      options:{responsive:true}
    });
  }else{
    txChart.data.labels=labels;
    txChart.data.datasets[0].data=txValues;
    txChart.data.datasets[1].data=dappsValues;
    txChart.data.datasets[2].data=dexValues;
    txChart.update();
  }
}

// Asset List
async function loadAssets(){
  const res=await fetch(`${PI_HORIZON}/assets?limit=20`);
  const data=await res.json();
  document.getElementById("assetTable").innerHTML=
    data._embedded.records.map(a=>`<tr><td>${a.asset_code}</td><td>${a.asset_issuer.slice(0,6)}...</td><td>${a.num_accounts}</td></tr>`).join("");
}

// dApps Radar
const piApps=[
  {name:"Pi Browser", url:"https://minepi.com", category:"Core"},
  {name:"Pi Chain Mall", url:"#", category:"Marketplace"},
  {name:"Pi NFT Hub", url:"#", category:"NFT"},
  {name:"Pi DeFi Swap", url:"#", category:"DeFi"}
];
function loadApps(){
  document.getElementById("appList").innerHTML=
    piApps.map(a=>`<li>üîπ <b>${a.name}</b> (${a.category})<br><a href="${a.url}" target="_blank">${a.url}</a></li>`).join("");
}
function filterApps(){
  const q=document.getElementById("appSearch").value.toLowerCase();
  document.getElementById("appList").innerHTML=
    piApps.filter(a=>a.name.toLowerCase().includes(q))
      .map(a=>`<li>üîπ <b>${a.name}</b> (${a.category})</li>`).join("");
}

// DEX Multi-Pair
async function loadDex(){
  try{
    const pairs=[
      {code:"PI/USDT", url:"https://horizon-testnet.stellar.org/order_book?selling_asset_type=native&buying_asset_type=credit_alphanum4&buying_asset_code=USDT&buying_asset_issuer=GAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWHF"},
      {code:"PI/USDC", url:"https://horizon-testnet.stellar.org/order_book?selling_asset_type=native&buying_asset_type=credit_alphanum4&buying_asset_code=USDC&buying_asset_issuer=GAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWHF"}
    ];
    let html="";
    for(const p of pairs){
      const res=await fetch(p.url);
      const data=await res.json();
      html+=`<tr><td>${p.code}</td><td>${data.bids?.[0]?.price||"N/A"}</td><td>${data.bids?.[0]?.amount||"N/A"}</td></tr>`;
    }
    document.getElementById("dexTable").innerHTML=html;
  }catch{ document.getElementById("dexTable").innerHTML=`<tr><td colspan="3">DEX data unavailable</td></tr>`; }
}

// Init + Auto-refresh
function init(){
  loadNetworkStatus();
  loadCharts();
  loadAssets();
  loadApps();
  loadDex();
}
init();
setInterval(init,20000);
</script>
</body>
</html>
